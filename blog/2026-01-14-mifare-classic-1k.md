---
date: '2026-01-14T00:00:00+0800'
title: Mifare Classic 1k 卡片完全解析
description: 你知道每天在用的門禁卡到底存了什麼嗎？這篇帶你深入底層，從資料結構、可用指令到權限控制完全解析。搞懂這些硬核細節，才不會在玩卡片時，不小心把它變磚喔！
image: https://i.imgur.com/46p5s9X.png
tags:
  - ithelp-ironman
  - NFC
  - RFID
meta:
  - property: og:image:width
    content: 1200
  - property: og:image:height
    content: 630
---

# Mifare Classic 1k 卡片完全解析

![](https://i.imgur.com/46p5s9X.png)

大家好，我是「[chameleon-ultra.js](https://taichunmin.idv.tw/chameleon-ultra.js/)」的作者均民。

你是否好奇過，我們每天掛在脖子上的門禁卡、開門及搭電梯用的感應扣，裡面到底存了什麼東西？在台灣最常見的門禁卡類型，非 Mifare Classic 1k（簡稱 M1 卡）莫屬！

今天這篇文章，均民要帶大家像剝洋蔥一樣，一層一層深入這張小小的卡片，從它的「房間」（資料結構）、守護房間的「門鎖」（權限控制），到我們如何「使用房間」（資料操作）。搞懂這些底層細節，不只能滿足好奇心，更是開發相關應用或除錯時的基本功，最重要的是——可以避免你在研究卡片時，因為設錯參數而讓卡片「變磚」（永久鎖死）喔！

## 資料結構：就像一棟 16 層樓的公寓

M1 卡的總容量只有 1024 bytes（1KB），這在現在看來雖然很小，但對於存取門禁 ID 或小額儲值已經很夠用了。

如果我們把卡片想像成一棟 **16 層樓的公寓**：

* **區段 (Sector)**：如果我們把區段比喻成公寓的樓層，這棟公寓總共有 16 樓層（Sector 0 ~ Sector 15）。
* **區塊 (Block)**：如果我們把區塊比喻成房間，那麼每層樓都有 4 個房間（Block 0 ~ Block 3）。
* **區塊大小**：每個區塊都能儲存 16 bytes。

讀寫操作的基本單位是「區塊」（Block），你不能只修改房間裡的一個角落，必須整間房間的資料一起讀出來或寫進去。

![](https://i.imgur.com/yvIbm0i.jpeg)

### 製造商區塊 (Manufacturer block)：就像是門牌及大廳

這棟公寓的「第 0 區段第 0 房」（Sector 0 Block 0）非常特別，它就像是這張卡片的「門牌及大廳」。

在卡片出廠時，這裡就被燒錄了製造商資訊和**卡片序號 (UID)**。對於正常的 M1 卡來說，這個區塊是**唯讀**的，就像建築物的門牌一樣不能隨便更改。

卡片的 UID 通常有 4 bytes 或 7 bytes 兩種格式：

![](https://i.imgur.com/GA316AA.png)

> **小知識：什麼是魔術卡 (Magic Card)？**
> 市面上有一種特殊的「魔術卡」（或稱 UID 卡），它的 Sector 0 Block 0 是可以被修改的。這意味著你可以把它改成跟別張卡片一模一樣的 UID，通常被用來做備份卡或測試用途。魔術卡通常還會把防碰撞 (Anti-collision) 資料存在這裡：
> 
> ![](https://i.imgur.com/Alx5jaq.jpeg)

在 4 bytes UID 的卡片中，會有一個 **BCC (Block Check Character)** 欄位，它是用來驗證 UID 是否正確的檢查碼，計算方式很簡單，就是把 UID 的 4 個 bytes 做 XOR 運算：

```c
// ^ 代表 XOR (互斥或) 運算
BCC = UID0 ^ UID1 ^ UID2 ^ UID3
```

### 資料區塊 (Data blocks)：就像是普通房間

如果我們將區塊比喻成房間，除了第 0 樓 0 號房被當成製造商區塊外，每層樓的前三個房間 (Block 0 ~ 2) 通常都是普通房間，這些房間叫做「資料區塊」。

你可以把這些房間拿來存任何資料，比如員工編號、到期日等等。這些房間的存取權限，則是由該樓層的「樓層規則」來控制。

### 值區塊 (Value blocks)：像是房間增加了「數位錢包」功能

如果你依照特定的格式把資料寫入資料區塊，這個區塊就會變成「值區塊」。就好像是這些房間增加了「數位錢包」的功能。

除了存餘額之外，還支援 **加值 (Increment)**、**減值 (Decrement)**、**還原 (Restore)** 和 **轉存 (Transfer)** 這些資料操作，確保對錢包餘額進行操作時不會出錯。

為了怕資料壞掉，值區塊的設計非常謹慎，同一個數值會正著存、反著存（取補數）好幾次來互相驗證：

* **value**：你的餘額（4 bytes 有號整數）。會存三次（兩次正本，一次補數備份）。
* **adr**：位址指標（1 byte）。用來指明這個備份是屬於哪裡的。

![](https://i.imgur.com/Nxfmu3a.png)

### 區段尾端區塊 (Sector trailer)：就像是房間的門鎖

如果把區塊比喻成房間，每個樓層的最後一個房間 (Block 3)，就像是房間的門鎖，記錄著該房間可以用什麼鑰匙做什麼事情。這個區塊至關重要，它掌管了：

1. **Key A** (6 bytes)：A 鑰匙，通常是主鑰匙。
2. **存取權限 (Access Bits)** (4 bytes)：存取規則，決定什麼鑰匙可以讀寫資料、誰可以改鑰匙。
3. **Key B** (6 bytes)：B 鑰匙，可選用的副鑰匙。

**注意**：讀取這個區塊時，Key A 永遠會顯示為 `00 00 00 00 00 00`（以防金鑰洩漏），這不代表密碼真的都是 `00` 喔！

![](https://i.imgur.com/HfAigVe.png)

## 存取權限：變磚危機的核心

::: info
**神器推薦**：計算 Mifare Classic 存取權限的網頁工具
這部分的計算非常繁瑣且容易出錯，均民寫了一個小工具幫大家算，可以直接使用：
<https://taichunmin.idv.tw/chameleon-ultra.js/mifare1k-acls.html>
:::

M1 卡最讓人頭痛、也最危險的地方就是這裡。如果把區塊比喻成房間的話，每間房間都會有 3 個控制位元 (A?, B?, C?) 來描述該房間的規則，4 個房間總共有 12 個控制位元，這些位元會以「原始值」和「反相值」的方式交錯儲存在「區段尾端區塊」（Sector Trailer）的中間 4 個 bytes 裡。

**為什麼說危險？** 因為如果你把存取規則設定錯誤，你就等於把這個樓層所有房間的門鎖都弄壞了。公寓的這個樓層就等於永久報廢，沒辦法救回來了！（俗稱變磚）

![](https://i.imgur.com/VDWF8W7.png)

### 資料區塊的控制位元

每個資料區塊 (Block 0~2) 都有 3 個控制位元，代表區塊的存取規則如下表：

![](https://i.imgur.com/bcfacSQ.png)

### 區段尾端區塊的控制位元

區段尾端區塊 (Block 3) 也有 3 個控制位元，代表該區塊的存取規則如下表：

![](https://i.imgur.com/L8U7MJt.png)

### 實戰範例：區段尾端區塊 `FF 07 80 69` 代表什麼？

這是最常見的出廠預設值。讓我們拆解 `FF 07 80 69`：

1.  **二進位拆解**：
    ```text
    Byte 6: FF (1111 1111)
    Byte 7: 07 (0000 0111)
    Byte 8: 80 (1000 0000)
    ```
2.  **對照權限表**：
    經過工具轉換後，我們會發現這代表：
    *   **資料區塊**：Key A 和 Key B 都可以進行任何的資料操作 (Read/Write/Inc/Dec/...)。
    *   **區段尾端區塊**：Key A 只能寫不能讀，Key B 可以讀寫。

![](https://i.imgur.com/gymoYGY.jpeg)

## 如何存取卡片的資料？

要存取卡片的資料，就像是諜報機構一樣，你要先找到對接的特工，使用雙方約定好的間諜術語，並核對暗號或口令。

### 卡片指令及狀態機 (State Machine)

![](https://i.imgur.com/z4n6rnH.png)

![](https://i.imgur.com/nfya44b.png)

### 取得存取權限

整個取得存取權限的流程可以簡化為四個步驟：

1.  **喚醒 (Wake Up)**：
    卡片平常在睡覺（省電），讀卡機發送 `REQA` 或 `WUPA` 指令，大喊「有人在嗎？」，卡片回傳 `ATQA` 說「我在！」。

2.  **防衝突與指名 (Anti-collision & Select)**：
    如果同時有多張卡片在感應區，讀卡機會透過防衝突機制讀取每張卡的 UID，然後指定其中一張：「就是你 (UID)，我要跟你講話」，其他卡片則會休息待命。選定後卡片回傳 `SAK`，告訴讀卡機它是什麼型號。

3.  **三階段認證 (Authentication)**：
    這是最關鍵的安全機制。讀卡機選定要操作的「樓層」，並拿出 Key 進行驗證。這是一個「挑戰-回應」的過程：
    *   **卡片**：「給你一個隨機數 `nt` (挑戰)。」
    *   **讀卡機**：「我用鑰匙把 `nt` 加密成 `ar` 回傳給你，順便附上我的隨機數 `nr`。」
    *   **卡片**：「檢查 `ar` 正確，代表你有鑰匙。我也把你的 `nr` 加密成 `at` 回傳給你，證明我也是合法的卡片。」
    
    一旦認證通過，接下來所有的傳輸資料都會被加密，防止被竊聽。

4.  **資料操作**：
    認證通過後，就可以對該區段中的區塊進行資料操作了。

### 資料操作指令

![](https://i.imgur.com/mBiANQn.png)

常見的指令如下：

*   **讀取 (Read)** / **寫入 (Write)**：基本的 16 bytes 讀寫。
*   **值區塊專用**：
    *   **加值 (Increment) / 減值 (Decrement)**：對「值區塊」中的數值進行加減，並放在「暫存區」中。
    *   **還原 (Restore)**：把「值區塊」的數值讀取到「暫存區」中。
    *   **轉存 (Transfer)**：把「暫存區」的數值寫入「值區塊」內。

## 結語

Mifare Classic 1k 雖然因為加密演算法（Crypto-1）早年被破解，在安全性上已不如新一代的卡片（如 Mifare DESFire），但因為成本低廉、系統相容性高，依然是目前最普及的卡片之一。

希望透過這篇文章，能讓你對這張小小的塑膠卡片有更深的認識。下次拿起門禁卡時，不妨想像一下裡面的 16 層公寓和管理員們正在忙碌地運作著呢！

如果你在看完文章後，對這個主題有興趣，或是在實作上遇到什麼「鬼打牆」的問題，都歡迎隨時透過 [Facebook](https://www.facebook.com/taichunmin) 找均民聊聊！

### 參考資料
- [NXP MF1S50YYX Datasheet](https://www.nxp.com/docs/en/data-sheet/MF1S50YYX_V1.pdf)
